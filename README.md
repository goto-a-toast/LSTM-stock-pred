# 株価予測プログラム（LSTM）

トヨタ自動車の株価をLSTM（長短期記憶）ニューラルネットワークで予測するプログラムです。
プログラミング初心者の方でも使えるように、段階的に実行できるようになっています。

---

## 🚀 最も簡単な方法：Google Colabで実行

**環境構築不要！ブラウザだけで今すぐ試せます。**

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/goto-a-toast/goto-a-toast.github.io/blob/claude/lstm-stock-prediction-83Fof/stock_prediction/LSTM_Stock_Prediction_Colab.ipynb)

### Google Colabとは？

Google Colabは、ブラウザ上でPythonコードを実行できる無料のサービスです。
- ✅ **環境構築不要** - Pythonのインストール不要
- ✅ **無料のGPU** - 高速な計算が可能
- ✅ **すぐに実行** - 登録だけで即利用可能

### 使い方

1. 上の「Open In Colab」ボタンをクリック
2. Googleアカウントでログイン
3. 上から順にセルを実行（Shift + Enterキー）
4. 約10分で完了！

**ローカル環境で実行したい場合は、以下の手順を参照してください。**

---

## 📋 目次

1. [必要なもの](#必要なもの)
2. [セットアップ](#セットアップ)
3. [使い方](#使い方)
4. [各ファイルの説明](#各ファイルの説明)
5. [LSTMとは？](#lstmとは)
6. [よくある質問](#よくある質問)

---

## 🛠️ 必要なもの

- **Python 3.8以上**
  - Pythonがインストールされているか確認: `python --version`
  - インストールされていない場合は [python.org](https://www.python.org/) からダウンロード

- **インターネット接続**
  - Yahoo Financeから株価データをダウンロードするため

---

## 🚀 セットアップ

### ステップ1: 必要なライブラリをインストール

```bash
# stock_predictionディレクトリに移動
cd stock_prediction

# 必要なライブラリをインストール
pip install -r requirements.txt
```

インストールには数分かかる場合があります。エラーが出た場合は、以下を試してください：

```bash
# pipをアップデート
pip install --upgrade pip

# もう一度インストール
pip install -r requirements.txt
```

---

## 📖 使い方

このプログラムは **3つのステップ** で実行します。

### ステップ1: データ取得 📊

Yahoo Financeからトヨタ自動車の株価データを取得します。

```bash
python 1_fetch_data.py
```

**実行結果：**
- `toyota_stock_data.csv` が作成されます
- 過去5年分の株価データが保存されます

**所要時間：** 約10～30秒

---

### ステップ2: モデルのトレーニング 🧠

LSTMモデルを訓練します。このステップが一番時間がかかります。

```bash
python 2_train_model.py
```

**実行結果：**
- `lstm_model.h5` モデルファイルが作成されます
- `scaler.npy` データ正規化情報が保存されます
- `training_history.png` トレーニング履歴のグラフが作成されます

**所要時間：** 約5～15分（PCの性能による）

**進捗表示：**
```
Epoch 1/50
45/45 [==============================] - 3s 65ms/step - loss: 0.0123 - val_loss: 0.0098
Epoch 2/50
45/45 [==============================] - 2s 44ms/step - loss: 0.0087 - val_loss: 0.0076
...
```

---

### ステップ3: 予測と可視化 📈

訓練したモデルで株価を予測し、グラフを作成します。

```bash
python 3_predict.py
```

**実行結果：**
- `prediction_result.png` 全期間の予測結果グラフ
- `prediction_recent.png` 最近60日間の詳細グラフ
- 予測精度（RMSE、MAE、MAPE）が表示されます

**所要時間：** 約10～30秒

---

## 📁 各ファイルの説明

### プログラムファイル

| ファイル名 | 説明 |
|-----------|------|
| `LSTM_Stock_Prediction_Colab.ipynb` | **Google Colab用ノートブック（推奨）** |
| `1_fetch_data.py` | Yahoo Financeから株価データを取得 |
| `2_train_model.py` | LSTMモデルを訓練 |
| `3_predict.py` | 株価を予測して結果を可視化 |
| `requirements.txt` | 必要なPythonライブラリのリスト |

### 生成されるファイル

| ファイル名 | 説明 |
|-----------|------|
| `toyota_stock_data.csv` | トヨタの株価データ（日付、始値、高値、安値、終値、出来高） |
| `lstm_model.h5` | 訓練済みLSTMモデル |
| `scaler.npy` | データの正規化パラメータ |
| `training_history.png` | モデルのトレーニング履歴グラフ |
| `prediction_result.png` | 予測結果の全体グラフ |
| `prediction_recent.png` | 予測結果の詳細グラフ（最近60日） |

---

## 🤖 LSTMとは？

**LSTM（Long Short-Term Memory）** は、時系列データ（株価など）を学習するのに適したニューラルネットワークの一種です。

### LSTMの特徴

1. **過去のパターンを記憶できる**
   - 過去60日分の株価の動きを覚えて、次の日の株価を予測

2. **長期的な依存関係を学習できる**
   - 数週間前のイベントが今日の株価に影響することを学習できる

3. **時系列予測に強い**
   - 株価、気温、売上など、時間と共に変化するデータの予測が得意

### このプログラムの仕組み

```
過去60日の株価 → LSTMモデル → 翌日の株価を予測
```

例：
- 入力：1月1日～3月1日（60日間）の終値
- 出力：3月2日の終値の予測値

---

## 💡 カスタマイズ方法

### 別の銘柄を予測したい場合

`1_fetch_data.py` の7行目を変更：

```python
# トヨタ自動車（7203.T）
TICKER = "7203.T"

# 例：ソニー（6758.T）
TICKER = "6758.T"

# 例：任天堂（7974.T）
TICKER = "7974.T"
```

### データ取得期間を変更したい場合

`1_fetch_data.py` の10～11行目を変更：

```python
# 過去5年分（デフォルト）
START_DATE = END_DATE - timedelta(days=5*365)

# 過去10年分にする場合
START_DATE = END_DATE - timedelta(days=10*365)
```

### 予測に使う日数を変更したい場合

`2_train_model.py` の22行目を変更：

```python
# 過去60日分を使用（デフォルト）
LOOK_BACK = 60

# 過去30日分にする場合
LOOK_BACK = 30
```

---

## ❓ よくある質問

### Q1: エラーが出ます

**A:** 以下を確認してください：

1. Pythonのバージョンが3.8以上か確認
   ```bash
   python --version
   ```

2. 必要なライブラリがインストールされているか確認
   ```bash
   pip list
   ```

3. インターネット接続を確認

### Q2: トレーニングに時間がかかりすぎます

**A:** `2_train_model.py` の24行目を変更してエポック数を減らせます：

```python
# デフォルト（50エポック）
EPOCHS = 50

# 速くしたい場合（20エポック）
EPOCHS = 20
```

ただし、エポック数を減らすと予測精度が下がる可能性があります。

### Q3: 予測精度が悪いです

**A:** 以下を試してください：

1. **データ期間を増やす**（より多くのデータで学習）
2. **エポック数を増やす**（より長く学習）
3. **LOOK_BACKを変更**（30、60、90日など試す）

株価予測は難しい問題で、100%正確な予測は不可能です。
このプログラムは教育・学習目的であり、実際の投資判断には使用しないでください。

### Q4: グラフが文字化けします

**A:** 日本語フォントがインストールされていない可能性があります。
プログラムは英語でグラフを表示するように設定されているため、
通常は問題ありません。

---

## 📊 評価指標の見方

予測結果には以下の3つの指標が表示されます：

### RMSE (Root Mean Squared Error)
- **二乗平均平方根誤差**
- 予測値と実際の値の差の大きさ
- **小さいほど良い**
- 単位：円

### MAE (Mean Absolute Error)
- **平均絶対誤差**
- 予測がどれくらいズレているかの平均
- **小さいほど良い**
- 単位：円

### MAPE (Mean Absolute Percentage Error)
- **平均絶対誤差率**
- 予測誤差のパーセンテージ
- **小さいほど良い**
- 単位：%
- 例：5% = 平均して5%ズレている

---

## ⚠️ 注意事項

1. **このプログラムは教育・学習目的です**
   - 実際の投資判断には使用しないでください
   - 株式投資にはリスクが伴います

2. **予測は100%正確ではありません**
   - 過去のデータから学習しているため、未来の予測には限界があります
   - 突発的なニュースやイベントには対応できません

3. **データは過去のものです**
   - Yahoo Financeから取得できるのは過去のデータのみです
   - リアルタイムの予測ではありません

---

## 📚 さらに学びたい方へ

### おすすめリソース

- **機械学習の基礎**
  - Coursera: Machine Learning by Andrew Ng
  - YouTube: 3Blue1Brown Neural Networks

- **Pythonプログラミング**
  - Python公式チュートリアル
  - PyQ（パイキュー）日本語学習サイト

- **株価予測・金融工学**
  - Kaggle: Stock Prediction コンペティション
  - QuantStart: 金融データ分析

---

## 📝 ライセンス

このプログラムは教育目的で自由に使用できます。

---

## 🙋 サポート

質問や問題があれば、GitHubのIssueで報告してください。

**Happy Learning! 📈🚀**
